"use strict";(self["webpackChunkheima_toutiao"]=self["webpackChunkheima_toutiao"]||[]).push([[572],{1572:function(t,e,o){o.r(e),o.d(e,{default:function(){return c}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{title:"登录/注册"}},[e("van-icon",{attrs:{slot:"left",name:"cross"},on:{click:function(e){return t.$router.back()}},slot:"left"})],1),e("van-form",{ref:"loginForm",on:{submit:t.onSubmit}},[e("van-field",{attrs:{name:"mobile",label:"手机号",placeholder:"请输入手机号",type:"number",maxlength:"11",rules:t.userFormRules.mobile},model:{value:t.user.mobile,callback:function(e){t.$set(t.user,"mobile",e)},expression:"user.mobile"}},[e("i",{staticClass:"toutiao toutiao-shouji",attrs:{slot:"left-icon"},slot:"left-icon"})]),e("van-field",{attrs:{name:"code",label:"验证码",placeholder:"请输入验证码",type:"number",maxlength:"6",rules:t.userFormRules.code},scopedSlots:t._u([{key:"button",fn:function(){return[t.countDownVisible?e("van-count-down",{attrs:{time:6e4,format:" ss s"},on:{finish:function(e){t.countDownVisible=!1}}}):e("van-button",{staticClass:"send-msg-btn",attrs:{type:"default",round:"","native-type":"button"},on:{click:function(e){return t.sendMsg()}}},[t._v("发送验证码")])]},proxy:!0}]),model:{value:t.user.code,callback:function(e){t.$set(t.user,"code",e)},expression:"user.code"}},[e("i",{staticClass:"toutiao toutiao-yanzhengma",attrs:{slot:"left-icon"},slot:"left-icon"})]),e("div",{staticClass:"login-btn-wrap"},[e("van-button",{staticClass:"login-btn",attrs:{block:"",type:"info","native-type":"submit"}},[t._v("登录")])],1)],1),t._v(" 登录页面 ")],1)},n=[],a=o(2900),r={name:"loginIndex",data(){return{countDownVisible:!1,user:{mobile:"",code:""},userFormRules:{mobile:[{required:!0,message:"请输入手机号"},{pattern:/^1[3|5|7|8]\d{9}$/,message:"手机号格式错误"}],code:[{required:!0,message:"请输入验证码"},{pattern:/^\d{6}$/,message:"验证码格式错误"}]}}},methods:{async sendMsg(){try{await this.$refs.loginForm.validate("mobile")}catch(t){return console.log("验证失败")}this.countDownVisible=!0;try{await(0,a.Z3)(this.user.mobile),this.$toast.success("发送成功")}catch(t){this.countDownVisible=!1,429===t.response.status?this.$toast.fail("发送次数太频繁，请稍后再试"):this.$toast.fail("发送失败，未知异常")}},async onSubmit(t){this.$toast.loading({duration:0,message:"加载中...",forbidClick:!0});try{const{data:t}=await(0,a.x4)(this.user);console.log("登录成功",t),this.$toast.success("登录成功"),this.$store.commit("setUser",t.data),this.$router.back()}catch(e){400===e.response.status?(console.log("登录失败",e),this.$toast.fail("登录失败")):(console.log("系统异常，稍后再试"),this.$toast.fail("系统异常，稍后再试"))}}}},i=r,u=o(1001),l=(0,u.Z)(i,s,n,!1,null,"1c24456e",null),c=l.exports},2900:function(t,e,o){o.d(e,{DO:function(){return v},Ff:function(){return i},J$:function(){return f},Lj:function(){return b},R3:function(){return u},WF:function(){return d},Z3:function(){return a},_Y:function(){return c},a1:function(){return l},bG:function(){return r},dE:function(){return m},et:function(){return h},x4:function(){return n}});var s=o(8859);const n=t=>(0,s.Z)({method:"POST",url:"/v1_0/authorizations",data:t}),a=t=>(0,s.Z)({method:"GET",url:`/v1_0/sms/codes/${t}`}),r=()=>(0,s.Z)({method:"GET",url:"/v1_0/user"}),i=()=>(0,s.Z)({method:"GET",url:"/v1_0/user/channels"}),u=t=>(0,s.Z)({method:"POST",url:"/v1_0/user/followings",data:{target:t}}),l=t=>(0,s.Z)({method:"DELETE",url:`/v1_0/user/followings/${t}`}),c=t=>(0,s.Z)({method:"POST",url:"/v1_0/article/collections",data:{target:t}}),d=t=>(0,s.Z)({method:"DELETE",url:`/v1_0/article/collections/${t}`}),m=t=>(0,s.Z)({method:"POST",url:"/v1_0/article/likings",data:{target:t}}),f=t=>(0,s.Z)({method:"DELETE",url:`/v1_0/article/likings/${t}`}),h=()=>(0,s.Z)({method:"GET",url:"/v1_0/user/profile"}),b=t=>(0,s.Z)({method:"PATCH",url:"/v1_0/user/profile",data:t}),v=t=>(0,s.Z)({method:"PATCH",url:"/v1_0/user/photo",data:t})}}]);
//# sourceMappingURL=572.24436c81.js.map