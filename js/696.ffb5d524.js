"use strict";(self["webpackChunkheima_toutiao"]=self["webpackChunkheima_toutiao"]||[]).push([[696],{8696:function(t,e,a){a.r(e),a.d(e,{default:function(){return G}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{fixed:""}},[e("van-button",{staticClass:"search-btn",attrs:{slot:"title",type:"info",round:"",icon:"search",size:"small"},on:{click:function(e){return t.$router.push("/search")}},slot:"title"},[t._v("搜索")])],1),e("van-tabs",{staticClass:"channel-tabs",attrs:{animated:"",swipeable:"",sticky:""},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[t._l(t.channels,(function(t){return e("van-tab",{key:t.id,attrs:{title:t.name}},[e("articleList",{attrs:{channel:t}})],1)})),e("div",{staticClass:"placeholder",attrs:{slot:"nav-right"},slot:"nav-right"}),e("div",{staticClass:"more-btn",attrs:{slot:"nav-right"},on:{click:function(e){t.isChannelEditShow=!0}},slot:"nav-right"},[e("i",{staticClass:"toutiao toutiao-gengduo"})])],2),e("van-popup",{style:{height:"100%"},attrs:{closeable:"",position:"bottom","close-icon-position":"top-left"},model:{value:t.isChannelEditShow,callback:function(e){t.isChannelEditShow=e},expression:"isChannelEditShow"}},[e("channel-edit",{attrs:{"my-channels":t.channels,active:t.active},on:{"update-active":t.onUpdateActive}})],1)],1)},n=[],i=a(2900),l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-list"},[e("van-pull-refresh",{attrs:{"success-text":t.RefreshSuccessText,"success-duration":"1000"},on:{refresh:t.onRefresh},model:{value:t.isRefreshLoading,callback:function(e){t.isRefreshLoading=e},expression:"isRefreshLoading"}},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载"},on:{load:t.onLoad,"update:error":function(e){t.error=e}},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t,a){return e("article-item",{key:a,attrs:{article:t}})})),1)],1)],1)},r=[],o=a(8572),c=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-item"},[e("van-cell",{attrs:{to:{name:"article",params:{articleId:t.article.art_id}}}},[e("div",{staticClass:"title van-multi-ellipsis--l2",attrs:{slot:"title"},slot:"title"},[t._v(" "+t._s(t.article.title)+" ")]),e("div",{staticClass:"description",attrs:{slot:"label"},slot:"label"},[3===t.article.cover.type?e("div",{staticClass:"cover-wrap"},t._l(t.article.cover.images,(function(t,a){return e("div",{key:a,staticClass:"cover-item"},[e("van-image",{staticClass:"cover-item-img",attrs:{src:t}})],1)})),0):t._e(),e("span",[t._v(t._s(t.article.aut_name))]),e("span",[t._v(t._s(t.article.comm_count)+"评论")]),e("span",[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))])]),1===t.article.cover.type?e("van-image",{staticClass:"right-cover",attrs:{slot:"default",src:t.article.cover.images[0],fit:"cover"},slot:"default"}):t._e()],1)],1)},h=[],d={name:"articleItem",props:{article:{type:Object,required:!0}},data(){return{}},mounted(){},methods:{}},u=d,m=a(1001),v=(0,m.Z)(u,c,h,!1,null,"30d01e50",null),f=v.exports,p={name:"ArticleList",components:{articleItem:f},props:{channel:{type:Object,required:!0}},data(){return{list:[],loading:!1,finished:!1,timestamp:null,error:!1,isRefreshLoading:!1,RefreshSuccessText:"刷新成功"}},mounted(){},methods:{async onRefresh(){try{const{data:t}=await(0,o.f)({channel_id:this.channel.id,timestamp:Date.now(),with_top:1});this.list.unshift(...t.data.results),this.isRefreshLoading=!1,this.RefreshSuccessText=`刷新成功,本次刷新了${t.data.results.length}条数据`}catch(t){this.isRefreshLoading=!1,this.RefreshSuccessText="刷新失败，请稍后再试"}},async onLoad(){try{const{data:t}=await(0,o.f)({channel_id:this.channel.id,timestamp:this.timestamp||Date.now(),with_top:1});console.log(t.data.results),this.list=[...this.list,...t.data.results],this.loading=!1,t.data.results.length?this.timestamp=t.data.pre_timestamp:this.finished=!0}catch(t){this.loading=!1,this.error=!0}}}},C=p,_=(0,m.Z)(C,l,r,!1,null,"98323342",null),g=_.exports,y=(a(6699),function(){var t=this,e=t._self._c;return e("div",{staticClass:"channel-edit"},[e("van-cell",{attrs:{title:"我的频道"}},[e("van-button",{staticClass:"edit-btn",attrs:{type:"danger",plain:"",round:"",size:"mini"},on:{click:t.onToggleEdit}},[t._v(t._s(t.editText))])],1),e("van-grid",{staticClass:"my-grid",attrs:{gutter:10}},t._l(t.myChannels2,(function(a,s){return e("van-grid-item",{key:s,staticClass:"channel-item",attrs:{icon:t.isEdit&&!t.fixedChannel.includes(a.id)?"close":""},on:{click:function(e){return t.onRemoveChannel(a,s)}}},[e("span",{staticClass:"text",class:{active:s===t.active},attrs:{slot:"text"},slot:"text"},[t._v(t._s(a.name))])])})),1),e("van-cell",{attrs:{title:"推荐频道"}}),e("van-grid",{staticClass:"recommend-grid",attrs:{gutter:10}},t._l(t.recommendChannels,(function(a,s){return e("van-grid-item",{key:s,staticClass:"channel-item",attrs:{text:a.name,icon:"plus"},on:{click:function(e){return t.onAddChannel(a)}}})})),1)],1)}),E=[],T=a(8859);const x=()=>(0,T.Z)({url:"/v1_0/channels",method:"GET"}),b=t=>(0,T.Z)({url:"/v1_0/user/channels",method:"PATCH",data:{channels:[t]}}),w=t=>(0,T.Z)({url:`/v1_0/user/channels/${t}`,method:"DELETE"});var Z=a(7247),L=a(3822),k={name:"ChannelEdit",data(){return{allChannels:[],myChannels2:[],isEdit:!1,editText:"编辑",fixedChannel:[0,1,2]}},props:{myChannels:{type:Array,required:!0},active:{type:Number,required:!0}},computed:{...(0,L.rn)(["user"]),recommendChannels(){return this.allChannels.filter((t=>!this.myChannels2.find((e=>e.id===t.id))))}},created(){this.loadAllChannels(),this.myChannels2=this.myChannels},methods:{async deleteChannel(t){if(this.user)try{await w(t)}catch(e){this.$toast("删除用户频道失败")}else(0,Z.LS)("TOUTIAO_CHANNELS",this.myChannels2)},onRemoveChannel(t,e){if(this.isEdit){if(this.fixedChannel.includes(t.id))return;this.myChannels2=this.myChannels2.filter((e=>e.id!==t.id)),this.deleteChannel(t.id),this.loadAllChannels(),e<=this.active&&this.$emit("update-active",this.active-1,!0)}else this.$emit("update-active",e,!1)},onToggleEdit(){"编辑"===this.editText?(this.editText="完成",this.isEdit=!0):(this.editText="编辑",this.isEdit=!1)},async onAddChannel(t){if(this.myChannels2.push(t),this.user)try{await b({id:t.id,seq:this.myChannels2.length})}catch(e){this.$toast("添加频道失败")}else(0,Z.LS)("TOUTIAO_CHANNELS",this.myChannels2)},async loadAllChannels(){try{const{data:t}=await x();console.log(t),this.allChannels=t.data.channels}catch(t){this.$toast("获取频道失败")}}}},A=k,S=(0,m.Z)(A,y,E,!1,null,"269a3626",null),O=S.exports,R={name:"homeIndex",components:{articleList:g,channelEdit:O},created(){this.loadChannel()},methods:{onUpdateActive(t,e=!0){this.active=t,this.isChannelEditShow=e},async loadChannel(){try{if(this.user){const{data:t}=await(0,i.Ff)();console.log(t),console.log(1),this.channels=t.data.channels}else if((0,Z.rV)("TOUTIAO_CHANNELS"))this.channels=(0,Z.rV)("TOUTIAO_CHANNELS");else{const{data:t}=await(0,i.Ff)();console.log(t),console.log(1),this.channels=t.data.channels}}catch(t){this.$toast("获取用户频道失败")}}},data(){return{active:0,channels:[],isChannelEditShow:!1}},computed:{...(0,L.rn)(["user"])}},$=R,N=(0,m.Z)($,s,n,!1,null,"5dfaee0c",null),G=N.exports},8572:function(t,e,a){a.d(e,{P:function(){return i},f:function(){return n}});var s=a(8859);const n=t=>(0,s.Z)({method:"GET",url:"/v1_0/articles",params:t}),i=t=>(0,s.Z)({method:"GET",url:`/v1_0/articles/${t}`})},2900:function(t,e,a){a.d(e,{DO:function(){return p},Ff:function(){return r},J$:function(){return m},Lj:function(){return f},R3:function(){return o},WF:function(){return d},Z3:function(){return i},_Y:function(){return h},a1:function(){return c},bG:function(){return l},dE:function(){return u},et:function(){return v},x4:function(){return n}});var s=a(8859);const n=t=>(0,s.Z)({method:"POST",url:"/v1_0/authorizations",data:t}),i=t=>(0,s.Z)({method:"GET",url:`/v1_0/sms/codes/${t}`}),l=()=>(0,s.Z)({method:"GET",url:"/v1_0/user"}),r=()=>(0,s.Z)({method:"GET",url:"/v1_0/user/channels"}),o=t=>(0,s.Z)({method:"POST",url:"/v1_0/user/followings",data:{target:t}}),c=t=>(0,s.Z)({method:"DELETE",url:`/v1_0/user/followings/${t}`}),h=t=>(0,s.Z)({method:"POST",url:"/v1_0/article/collections",data:{target:t}}),d=t=>(0,s.Z)({method:"DELETE",url:`/v1_0/article/collections/${t}`}),u=t=>(0,s.Z)({method:"POST",url:"/v1_0/article/likings",data:{target:t}}),m=t=>(0,s.Z)({method:"DELETE",url:`/v1_0/article/likings/${t}`}),v=()=>(0,s.Z)({method:"GET",url:"/v1_0/user/profile"}),f=t=>(0,s.Z)({method:"PATCH",url:"/v1_0/user/profile",data:t}),p=t=>(0,s.Z)({method:"PATCH",url:"/v1_0/user/photo",data:t})}}]);
//# sourceMappingURL=696.ffb5d524.js.map