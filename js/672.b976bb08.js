"use strict";(self["webpackChunkheima_toutiao"]=self["webpackChunkheima_toutiao"]||[]).push([[672],{3672:function(t,e,o){o.r(e),o.d(e,{default:function(){return it}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{"left-arrow":"",title:"黑马头条"},on:{"click-left":function(e){return t.$router.back()}}}),e("div",{staticClass:"main-wrap"},[t.loading?e("div",{staticClass:"loading-wrap"},[e("van-loading",{attrs:{color:"#3296fa",vertical:""}},[t._v("加载中")])],1):t.article.title?e("div",{staticClass:"article-detail"},[e("h1",{staticClass:"article-title"},[t._v(t._s(t.article.title))]),e("van-cell",{staticClass:"user-info",attrs:{center:"",border:!1}},[e("van-image",{staticClass:"avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.article.aut_photo},slot:"icon"}),e("div",{staticClass:"user-name",attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.article.aut_name))]),e("div",{staticClass:"publish-date",attrs:{slot:"label"},slot:"label"},[t._v(" "+t._s(t._f("relativeTime")(t.article.pubdate))+" ")]),e("follow-user",{attrs:{aut_id:t.article.aut_id},model:{value:t.article.is_followed,callback:function(e){t.$set(t.article,"is_followed",e)},expression:"article.is_followed"}})],1),e("div",{ref:"article-content",staticClass:"article-content markdown-body",domProps:{innerHTML:t._s(t.article.content)}}),e("van-divider",[t._v("正文结束")]),e("van-cell",{attrs:{title:"全部评论"}}),e("comment-list",{attrs:{source:t.article.art_id,list:t.list},on:{"onload-success":function(e){t.totalComments=e.total_count},"reply-click":t.onReplyClick}}),e("div",{staticClass:"article-bottom"},[e("van-button",{staticClass:"comment-btn",attrs:{type:"default",round:"",size:"small"},on:{click:function(e){t.PostcomShow=!0}}},[t._v("写评论")]),e("van-icon",{attrs:{name:"comment-o",info:t.totalComments,color:"#777"}}),e("collect-article",{attrs:{"article-id":t.article.art_id},model:{value:t.article.is_collected,callback:function(e){t.$set(t.article,"is_collected",e)},expression:"article.is_collected"}}),e("liked-article",{attrs:{"article-id":t.article.art_id},model:{value:t.article.attitude,callback:function(e){t.$set(t.article,"attitude",e)},expression:"article.attitude"}}),e("van-icon",{attrs:{name:"share",color:"#777777"}})],1),e("van-popup",{attrs:{position:"bottom"},model:{value:t.PostcomShow,callback:function(e){t.PostcomShow=e},expression:"PostcomShow"}},[e("comment-post",{attrs:{target:t.article.art_id},on:{"post-success":t.onPostSuccess}})],1)],1):404===t.errstatus?e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("该资源不存在或已删除！")])],1):e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("内容加载失败！")]),e("van-button",{staticClass:"retry-btn",on:{click:t.loadArticleDetail}},[t._v("点击重试")])],1)]),e("van-popup",{staticStyle:{height:"100%"},attrs:{position:"bottom"},model:{value:t.isReplyShow,callback:function(e){t.isReplyShow=e},expression:"isReplyShow"}},[t.isReplyShow?e("comment-reply",{attrs:{replyComment:t.currentComment},on:{close:function(e){t.isReplyShow=!1}}}):t._e()],1)],1)},a=[],i=o(8572),n=o(6471),l=function(){var t=this,e=t._self._c;return t.value?e("van-button",{staticClass:"follow-btn",attrs:{round:"",size:"small",loading:t.followLoading},on:{click:t.onFollow}},[t._v("已关注")]):e("van-button",{staticClass:"follow-btn",attrs:{type:"info",color:"#3296fa",round:"",loading:t.followLoading,size:"small",icon:"plus"},on:{click:t.onFollow}},[t._v("关注")])},r=[],c=o(2900),u={name:"followUserIndex",model:{name:"value",event:"input"},props:{value:{type:Boolean,required:!0},aut_id:{type:[Number,String,Object],required:!0}},data(){return{followLoading:!1}},mounted(){},methods:{async onFollow(){this.followLoading=!0;try{this.value?await(0,c.a1)(this.aut_id):await(0,c.R3)(this.aut_id),this.$emit("input",!this.value)}catch(t){let e="关注失败，请重试";t.response&&400===t.response.status&&(e="自己不能关注自己"),this.$toast(e)}this.followLoading=!1}}},m=u,d=o(1001),h=(0,d.Z)(m,l,r,!1,null,"31d2d655",null),p=h.exports,v=function(){var t=this,e=t._self._c;return e("van-icon",{class:{collected:t.value},attrs:{color:"#777",name:t.value?"star":"star-o",loading:t.loading},on:{click:t.onCollect}})},f=[],_={name:"collectArticleIndex",props:{value:{type:Boolean,required:!0},articleId:{type:[Number,String,Object],required:!0}},data(){return{loading:!1}},mounted(){},methods:{async onCollect(){this.loading=!0;try{this.value?await(0,c.WF)(this.articleId):await(0,c._Y)(this.articleId),this.$emit("input",!this.value),this.$toast.success(this.value?"取消收藏":"收藏成功")}catch(t){this.$toast.fail("操作失败，请稍后重试")}this.loading=!1}}},g=_,b=(0,d.Z)(g,v,f,!1,null,"834d70aa",null),y=b.exports,w=function(){var t=this,e=t._self._c;return e("van-icon",{class:{liked:t.value},attrs:{color:"#777",name:t.value?"good-job":"good-job-o",loading:t.loading},on:{click:t.onCollect}})},C=[],k={name:"collectArticleIndex",props:{value:{type:Number,required:!0},articleId:{type:[Number,String,Object],required:!0}},data(){return{loading:!1}},mounted(){},methods:{async onCollect(){this.loading=!0;try{1===this.value?await(0,c.J$)(this.articleId):await(0,c.dE)(this.articleId),this.$emit("input",1===this.value?0:1),this.$toast.success(1===this.value?"取消点赞":"点赞成功")}catch(t){this.$toast.fail("操作失败，请稍后重试")}this.loading=!1}}},S=k,$=(0,d.Z)(S,w,C,!1,null,"37347ffc",null),P=$.exports,Z=function(){var t=this,e=t._self._c;return e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载","immediate-check":!1},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(o,s){return e("commentItem",{key:s,attrs:{comment:o},on:{"update-comLike":function(t){o.is_liking=t},"update-comCount":function(t){o.like_count=t},"reply-click":function(e){return t.$emit("reply-click",e)}}})})),1)},x=[],L=(o(6699),o(8859));const I=t=>(0,L.Z)({method:"GET",url:"/v1_0/comments",params:t}),T=t=>(0,L.Z)({method:"POST",url:"/v1_0/comment/likings",data:{target:t}}),E=t=>(0,L.Z)({method:"DELETE",url:`/v1_0/comment/likings/${t}`}),j=t=>(0,L.Z)({method:"POST",url:"/v1_0/comments",data:t});var O=function(){var t=this,e=t._self._c;return e("van-cell",{staticClass:"comment-item"},[e("van-image",{staticClass:"avatar",attrs:{slot:"icon",round:"",fit:"cover",src:t.comment.aut_photo},slot:"icon"}),e("div",{staticClass:"title-wrap",attrs:{slot:"title"},slot:"title"},[e("div",{staticClass:"user-name"},[t._v(t._s(t.comment.aut_name))]),e("van-button",{staticClass:"like-btn",class:{liked:t.comment.is_liking},attrs:{icon:t.comment.is_liking?"good-job":"good-job-o",loading:t.loading},on:{click:t.onCommentLike}},[t._v(t._s(t.comment.like_count||"赞"))])],1),e("div",{attrs:{slot:"label"},slot:"label"},[e("p",{staticClass:"comment-content"},[t._v(t._s(t.comment.content))]),e("div",{staticClass:"bottom-info"},[e("span",{staticClass:"comment-pubdate"},[t._v(t._s(t._f("relativeTime")(t.comment.pubdate)))]),e("van-button",{staticClass:"reply-btn",attrs:{round:""},on:{click:function(e){return t.$emit("reply-click",t.comment)}}},[t._v("回复 "+t._s(t.comment.reply_count))])],1)])],1)},R=[],q={name:"CommentItem",components:{},props:{comment:{type:Object,required:!0}},data(){return{loading:!1}},computed:{},watch:{},created(){},mounted(){},methods:{async onCommentLike(){this.loading=!0;try{this.comment.is_liking?(await E(this.comment.com_id),this.$emit("update-comCount",this.comment.like_count-1)):(await T(this.comment.com_id),this.$emit("update-comCount",this.comment.like_count+1)),this.$emit("update-comLike",!this.comment.is_liking)}catch(t){this.$toast("操作失败，请稍后重试")}this.loading=!1}}},A=q,D=(0,d.Z)(A,O,R,!1,null,"3f5730e1",null),G=D.exports,N={name:"CommentListIndex",props:{source:{type:[Number,String,Object],required:!0},list:{type:Array,default(){return[]}},type:{type:String,default:"a",validator(t){return["a","c"].includes(t)}}},components:{commentItem:G},data(){return{loading:!1,finished:!1,error:!1,offset:null,limit:10}},mounted(){},created(){this.loading=!0,this.onLoad()},methods:{async onLoad(){try{const{data:t}=await I({type:this.type,source:this.source.toString(),offset:this.offset,limit:this.limit});console.log(t.data),this.list.push(...t.data.results),t.data.results.length?this.offset=t.data.last_id:this.finished=!0,this.$emit("onload-success",t.data),this.loading=!1}catch(t){console.log(t.message),this.error=!0,this.loading=!1}}}},z=N,F=(0,d.Z)(z,Z,x,!1,null,"58a352cc",null),H=F.exports,B=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-post"},[e("van-field",{staticClass:"post-field",attrs:{rows:"2",autosize:"",type:"textarea",maxlength:"50",placeholder:"请输入留言","show-word-limit":""},model:{value:t.message,callback:function(e){t.message="string"===typeof e?e.trim():e},expression:"message"}}),e("van-button",{staticClass:"post-btn",attrs:{disabled:!t.message},on:{click:t.onPost}},[t._v("发布")])],1)},J=[],U={name:"CommentPost",components:{},inject:{articleId:{type:[Number,String,Object],default:null}},props:{target:{type:[Number,String,Object],required:!0}},data(){return{message:""}},computed:{},watch:{},created(){},mounted(){},methods:{async onPost(){this.$toast.loading({message:"加载中...",forbidClick:!0,duration:0});try{const{data:t}=await j({target:this.target.toString(),content:this.message,art_id:this.articleId?this.articleId.toString():null});this.message="",console.log(t.data),this.$emit("post-success",t.data),this.$toast.success("发表评论成功")}catch(t){this.$toast.fail("发表评论失败")}}}},W=U,Y=(0,d.Z)(W,B,J,!1,null,"a331b7aa",null),M=Y.exports,K=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-reply"},[e("van-nav-bar",{attrs:{title:t.replyComment.reply_count>0?`${t.replyComment.reply_count}条回复`:"暂无回复"}},[e("van-icon",{attrs:{slot:"left",name:"cross"},on:{click:function(e){return t.$emit("close")}},slot:"left"})],1),e("div",{staticClass:"main-body"},[e("comment-item",{attrs:{comment:t.replyComment}}),e("van-cell",{attrs:{title:"全部回复"}}),e("comment-list",{attrs:{source:t.replyComment.com_id,type:"c",list:t.commentList}})],1),e("div",{staticClass:"post-wrap"},[e("van-button",{staticClass:"post-btn",attrs:{round:"",size:"small"},on:{click:function(e){t.isPostShow=!0}}},[t._v("写评论")])],1),e("van-popup",{attrs:{position:"bottom"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[e("comment-post",{attrs:{target:t.replyComment.com_id},on:{"post-success":t.onPostSuccess}})],1)],1)},Q=[],V={name:"commentReply",components:{commentItem:G,commentList:H,commentPost:M},props:{replyComment:{type:Object,required:!0}},data(){return{isPostShow:!1,commentList:[]}},mounted(){},methods:{onPostSuccess(t){this.replyComment.reply_count++,this.isPostShow=!1,this.commentList.unshift(t.new_obj)}}},X=V,tt=(0,d.Z)(X,K,Q,!1,null,"41348e90",null),et=tt.exports,ot={name:"ArticleIndex",components:{followUser:p,collectArticle:y,likedArticle:P,commentList:H,commentPost:M,commentReply:et},props:{articleId:{type:[Number,String,Object],required:!0}},provide(){return{articleId:this.articleId}},data(){return{article:{},loading:!0,errstatus:0,followLoading:!1,totalComments:0,PostcomShow:!1,list:[],isReplyShow:!1,currentComment:{}}},computed:{},watch:{},activated(){this.loadArticleDetail()},mounted(){},methods:{onReplyClick(t){this.currentComment=t,this.isReplyShow=!0,console.log(t)},onPostSuccess(t){this.PostcomShow=!1,console.log(t),this.list.unshift(t.new_obj)},previewImg(){const t=this.$refs["article-content"],e=t.querySelectorAll("img"),o=[];e.forEach(((t,e)=>{o.push(t.src),t.onclick=()=>{(0,n.Z)({images:o,startPosition:e})}}))},async loadArticleDetail(){this.loading=!0;try{const{data:t}=await(0,i.P)(this.articleId);console.log(t),this.article=t.data,setTimeout((()=>{this.previewImg()}),0)}catch(t){t.response&&404===t.response.status&&(this.errstatus=404),this.$toast("文章详情获取失败")}this.loading=!1}}},st=ot,at=(0,d.Z)(st,s,a,!1,null,"72401af7",null),it=at.exports},8572:function(t,e,o){o.d(e,{P:function(){return i},f:function(){return a}});var s=o(8859);const a=t=>(0,s.Z)({method:"GET",url:"/v1_0/articles",params:t}),i=t=>(0,s.Z)({method:"GET",url:`/v1_0/articles/${t}`})},2900:function(t,e,o){o.d(e,{DO:function(){return f},Ff:function(){return l},J$:function(){return h},Lj:function(){return v},R3:function(){return r},WF:function(){return m},Z3:function(){return i},_Y:function(){return u},a1:function(){return c},bG:function(){return n},dE:function(){return d},et:function(){return p},x4:function(){return a}});var s=o(8859);const a=t=>(0,s.Z)({method:"POST",url:"/v1_0/authorizations",data:t}),i=t=>(0,s.Z)({method:"GET",url:`/v1_0/sms/codes/${t}`}),n=()=>(0,s.Z)({method:"GET",url:"/v1_0/user"}),l=()=>(0,s.Z)({method:"GET",url:"/v1_0/user/channels"}),r=t=>(0,s.Z)({method:"POST",url:"/v1_0/user/followings",data:{target:t}}),c=t=>(0,s.Z)({method:"DELETE",url:`/v1_0/user/followings/${t}`}),u=t=>(0,s.Z)({method:"POST",url:"/v1_0/article/collections",data:{target:t}}),m=t=>(0,s.Z)({method:"DELETE",url:`/v1_0/article/collections/${t}`}),d=t=>(0,s.Z)({method:"POST",url:"/v1_0/article/likings",data:{target:t}}),h=t=>(0,s.Z)({method:"DELETE",url:`/v1_0/article/likings/${t}`}),p=()=>(0,s.Z)({method:"GET",url:"/v1_0/user/profile"}),v=t=>(0,s.Z)({method:"PATCH",url:"/v1_0/user/profile",data:t}),f=t=>(0,s.Z)({method:"PATCH",url:"/v1_0/user/photo",data:t})}}]);
//# sourceMappingURL=672.b976bb08.js.map